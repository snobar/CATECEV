@using CATECEV.FE.Models.ViewModels
@model PartnerPaymentPageViewModel

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(function () {
            $('#paymentForm').submit(function (e) {
                debugger;
                e.preventDefault();
                $('.text-danger').text(''); // clear previous errors

                $.ajax({
                    url: '@Url.Action("Manage", "Home")',
                    type: 'POST',
                    data: $(this).serialize(),
                    success: function (res) {
                        debugger;
                        if (res.success) {
                                    location.reload(); // Reloads the entire page

                        } else {
                            res.errors.forEach(function (msg, i) {
                                $(`.field-validation-error:eq(${i})`).text(msg);
                            });
                        }
                    }
                });
            });
        });
    </script>
}

<style>
    body {
        font-size: 12px;
    }

    table, table th, table td,
    form, form label, form input,
    .btn {
        font-size: 12px !important;
    }
</style>
<div class="mb-3">
    <a asp-action="Index" asp-controller="Home" class="btn btn-secondary">
        ← Back to Partner List
    </a>
</div>

@if (Model.SelectedPartner != null)
{
    <div class="mb-4 border p-3 rounded bg-light">
        <h6>Partner Information</h6>
        <dl class="row mb-0">
            <dt class="col-sm-3">Name</dt>
            <dd class="col-sm-9">@Model.SelectedPartner.Name</dd>

            <dt class="col-sm-3">Reg No</dt>
            <dd class="col-sm-9">@Model.SelectedPartner.RegNo</dd>

            <dt class="col-sm-3">Monthly Platform Fee</dt>
            <dd class="col-sm-9">@Model.SelectedPartner.MonthlyPlatformFee.ToString()</dd>

            <dt class="col-sm-3">Balance Amount</dt>
            <dd class="col-sm-9">@Model.SelectedPartner.BalanceAmount.ToString()</dd>

            <dt class="col-sm-3">Last Calculation Date</dt>
            <dd class="col-sm-9">
                @(Model.SelectedPartner.LastCalculationBalanceDate == DateTime.MinValue
                    ? ""
                    : Model.SelectedPartner.LastCalculationBalanceDate.ToString("yyyy-MM-dd"))
            </dd>
        </dl>
    </div>
}

@using (Html.BeginForm("Manage", "Home", FormMethod.Post, new { @id = "paymentForm", @class = "d-flex flex-wrap align-items-end gap-2 mb-4" }))
{
    @Html.HiddenFor(m => m.NewPayment.PartnerId)

    <div>
        @Html.LabelFor(m => m.NewPayment.PaymentAmount, new { @class = "form-label" })
        @Html.TextBoxFor(m => m.NewPayment.PaymentAmount, new { @class = "form-control", type = "number", step = "0.01" })
    </div>
    <div>
        @Html.LabelFor(m => m.NewPayment.PaymentDate, new { @class = "form-label" })
        @Html.TextBoxFor(m => m.NewPayment.PaymentDate, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
    </div>
    <div>
        <label class="form-label d-block">&nbsp;</label>
        <button type="submit" class="btn btn-primary">Add</button>
    </div>
}

<hr />

<table class="table table-bordered">
    <thead>
        <tr>
            <th>Payment</th>
            <th>Date</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Payments)
        {
            <tr>
                <td>@item.PaymentAmount</td>
                <td>@item.PaymentDate.ToShortDateString()</td>
            </tr>
        }
    </tbody>
</table>

